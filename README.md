# Домашнее задание, Гетманов Михаил Михайлович БПИ223-2

## Задание
### Микросервис авторизации пользователей
#### Регистрация нового пользователя
- Реализовать конечную точку RESTful API для регистрации нового пользователя.
- Регистрация должна фиксировать информацию о пользователе с минимальным набором полей: имя пользователя (ник), адрес электронной почты (логин), пароль.
- Необходимо предусмотреть проверку входных данных на непустоту и корректность (например, имейл должен содержать символы “@”, “.” и т. д.; пароль должен состоять из не менее восьми символов, включая буквы обоих регистров, цифры и специальные символы; это можно реализовать с помощью регулярных выражений).
- важно предусмотреть различные коды ответов на HTTP-запросы клиентов и ответные сообщения для успешных и неудачных попыток регистрации.
- Необходимо продемонстрировать подтверждающее сообщение после успешной регистрации.

#### Вход пользователя в систему (авторизация)
- Реализовать конечную точку RESTful API для входа зарегистрированного пользователя в систему.
- Процесс входа в систему предполагает предоставление сервису электронной почты и пароля ранее зарегистрированного пользователя.
- Необходимо реализовать управление сессией с помощью JWT (токена) для поддержания статуса аутентификации пользователя.
- Требуется возвращать соответствующие коды состояния HTTP и ответные сообщения для успешных и неудачных попыток входа в систему.
- Необходимо продемонстрировать соответствующие сообщения об ошибках в случае неудачных попыток входа в систему с предоставлением некорректных данных.
  
#### Предоставление информации о пользователе
- Реализовать конечную точку RESTful API для выдачи информации о пользователе по токену.
- Требуется возвращать соответствующие коды состояния HTTP.


## Инструкция по запуску
В корневой директории проекта необходимо прописать команду:
```
docker-compose up
```
После запуска контейнера и появления в консоли лога, содержащего фразу
```
Started Application
```
можно будет посмотреть API приложения здесь [Auth API](http://localhost:8080/swagger-ui/index.html).

## API
Есть три запроса к микросервису:
<ol>
  <li>/users/find-by-token</li>
  <li>/sign-up</li>
  <li>/sign-in</li>
</ol> 

Если запрос не соответствует входным данным, то ответ будет 403.

### /users/find-by-token
Эта ручка отвечает за получение информации о пользователе по токену
Запрос состоит из одного поля:
```json
{
  "token": "string"
}
```
Поле `token` является строкой, содержащей токен некоторого пользователя.

Ответ в случае успеха выглядит следующим образом:
```json
{
  "user": {
    "id": 0,
    "nickname": "string",
    "email": "string",
    "password": "stringst",
    "created": "2024-06-09T20:44:01.682Z"
  }
}
```
Поле `user` содержит в себе информацию о пользователе.

Если пользователь не найден по токену, то код ответа 400 (`Bad Request`), ответ выглядит следующим образом:
```json
{
  "error": "string"
}
```
Поле `error` содержит информацию о причине неуспеха. Существует единственная причина ошибки:
```json
{
  "error": "No user exists with such token"
}
```

### /sign-up
Эта ручка отвечает за регистрацию нового пользователя.

Запрос:
```json
{
  "nickname": "string",
  "email": "string",
  "password": "stringst"
}
```
В запросе поле `nickname` отвечает за никнейм пользователя, `email` - электронная почта пользователя, `password` - пароль пользователя.

Ответ при успехе:
```json
{
  "token": "string"
}
```
Поле `token` содержит токен пользователя, который только что зарегистрировался. Токен является валидным.

Ответ при неудаче (`Bad Request`):
```json
{
  "error": "string"
}
```
Виды ошибок:
- `Wrong nickname format` - неправильный формат никнейма
- `Wrong email format` - неправильный формат почты
- `Wrong password format` - неправильный формат пароля
- `User with such email already exists` - уже существует пользователь с электронной почтой, указанной в запросе

Формат пароля:
> Пароль должен состоять из не менее восьми символов, включая буквы обоих регистров, цифры и специальные символы

Формат почты:
> Имейл должен содержать символы “@”, “.” и т.д
> 
### /sign-in
Эта ручка отвечает за авторизацию существующего пользователя
Запрос:
```json
{
  "email": "string",
  "password": "stringst"
}
```
`email` - электронная почта пользователя, `password` - пароль пользователя.

Ответ при успехе:
```json
{
  "token": "string"
}
```
Поле `token` содержит токен пользователя, который только что авторизовался. Токен является валидным.

Ответ при неудаче (`Bad Request`):
```json
{
  "error": "string"
}
```
Виды ошибок:
- `Incorrect credentials` - неправильные данные

### Архитектура
Приложение состоит из четырёх слоёв:
1. Контроллеры - `AuthenticationController`, `UserController`
2. Сервисы - `JwtService`, `AuthenticationService`, `UserService`
3. Репозитории - `UserRepository`, `SessionRepository`
4. База данных

Каждый слой обращается к нижестоящему и ничего не знает о слоях выше.

Контроллеры отвечают за предоставление ручек для клиентов.

Сервисы реализуют бизнес логику приложения - авторизацию, регистрацию, поиск пользователей, создание токенов.

Репозитории отвечают за работу с моделями и за обращения к БД.

### Использованные библиотеки
- `org.junit:junit-bom:5.9.1`
- `org.junit.jupiter:junit-jupiter`
- `org.projectlombok:lombok`
- `org.springframework.boot:spring-boot-starter`
- `org.springframework.boot:spring-boot-starter-web`
- `org.springframework.boot:spring-boot-starter-validation`
- `org.springframework.boot:spring-boot-starter-data-jpa`
- `org.springframework.boot:spring-boot-starter-security`
- `org.liquibase:liquibase-core`
- `org.postgresql:postgresql`
- `org.springframework.boot:spring-boot-starter-test`
- `org.springdoc:springdoc-openapi-starter-webmvc-ui:2.5.0`
- `org.springframework.boot:spring-boot-devtools`
- `com.h2database:h2`
- `com.auth0:java-jwt:3.14.0`
- `io.jsonwebtoken:jjwt-api:0.12.3`
- `io.jsonwebtoken:jjwt-impl:0.12.3`
- `io.jsonwebtoken:jjwt-jackson:0.12.3`
- `org.apache.commons:commons-lang3`
- `org.springdoc:springdoc-openapi-starter-webmvc-ui`

### Критерии
1. Корректная реализация сервиса авторизации пользователей (4 балла):
    1. ✔️ Регистрация пользователя (2 балл)
    2. ✔️ Вход пользователя в систему (1,5 балла)
    3. ✔️ Предоставление информации о пользователе (0.5 балла)
2. Корректная реализация сервиса обработки заказов на покупку билетов (3 балла в случае реализации сервиса авторизации пользователей)
    1. ❌ Обработка заказов на покупку билетов (2.5 балла)
    2. ❌ Предоставление информации о заказе (0.5 балл)
3. ✔️ Реализация коллекции Postman (или Swagger), которая должна демонстрировать функциональность реализованн(ого/ых) микросервис(а/ов),
   охватывая все API (1 балл в случае реализации сервис(а/ов)).
5. Качество кода и документация (2 балла):
    1. ✔️ Хорошо организованный, модульный и “чистый” код.
    2. ✔️ Качественная документация, включая краткое описание архитектуры системы и спецификацию API.
